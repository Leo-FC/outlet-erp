<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
<h:head>
    <title>Lista de Usuários</title>
    <h:outputStylesheet name="css/style.css" />
    <h:outputStylesheet name="css/panel.css" />
</h:head>
<h:body>
    <h:form id="formUsuarios">
        <p:growl id="growl" showDetail="true" />
        <p:panel>
            <f:facet name="header">
                <div class="module-header usuarios">
                    <i class="pi pi-users" style="font-size: 1.5rem;"></i>
                    <h:outputText value="Usuários Cadastrados" style="font-size: 1.2rem;" />
                </div>
            </f:facet>
            <p:dataTable id="tabelaUsuarios" widgetVar="tabelaUsuariosWV"
                         value="#{usuarioBean.usuarios}" var="u"
                         paginator="true" rows="10"
                         emptyMessage="Nenhum usuário encontrado.">

                <p:column headerText="Nome" filterBy="#{u.nomeCompleto}" filterMatchMode="contains">
                    <h:outputText value="#{u.nomeCompleto}" />
                </p:column>

                <p:column headerText="Email" filterBy="#{u.email}" filterMatchMode="contains">
                    <h:outputText value="#{u.email}" />
                </p:column>

                <p:column headerText="Categoria" filterBy="#{u.categoriaUsuario}" filterMatchMode="exact">
                    <f:facet name="filter">
                        <p:selectOneMenu onchange="PF('tabelaUsuariosWV').filter()">
                            <f:selectItem itemLabel="Todos" itemValue="#{null}" noSelectionOption="true" />
                            <f:selectItems value="#{usuarioBean.categorias}" var="cat" itemLabel="#{cat.toString()}" itemValue="#{cat}" />
                        </p:selectOneMenu>
                    </f:facet>
                    <h:outputText value="#{u.categoriaUsuario}" />
                </p:column>

                <p:column headerText="Status" filterBy="#{u.ativo}" filterMatchMode="exact" style="width:150px; text-align:center;">
                    <f:facet name="filter">
                        <p:selectOneMenu onchange="PF('tabelaUsuariosWV').filter()">
                            <f:selectItem itemLabel="Todos" itemValue="#{null}" noSelectionOption="true" />
                            <f:selectItem itemLabel="Ativo" itemValue="true" />
                            <f:selectItem itemLabel="Inativo" itemValue="false" />
                        </p:selectOneMenu>
                    </f:facet>
                    <p:tag styleClass="#{u.ativo ? 'ui-tag-success' : 'ui-tag-danger'}"
                           value="#{u.ativo ? 'Ativo' : 'Inativo'}" icon="#{u.ativo ? 'pi pi-check' : 'pi pi-times'}" />
                </p:column>

                <p:column headerText="Ações" width="100" style="text-align: center;">
                    <p:button icon="pi pi-pencil" styleClass="ui-button-info ui-button-flat"
                              outcome="editarUsuario.xhtml?id=#{u.id}" title="Editar" />
                    
                    <p:commandButton icon="pi pi-trash" title="Desativar"
                                     actionListener="#{usuarioBean.prepararExclusao(u)}"
                                     oncomplete="PF('confirmacaoExclusao').show()"
                                     update=":formConfirmacao"
                                     styleClass="ui-button-danger ui-button-flat" />
                </p:column>
            </p:dataTable>
        </p:panel>
        
        <div style="padding: 15px; display: flex; justify-content: center; gap: 15px;">
            <p:button value="Voltar" outcome="/admin/painelAdmin.xhtml" icon="pi pi-arrow-left" styleClass="ui-button-secondary"/>
            <p:button value="Novo Usuário" outcome="cadastrarUsuario.xhtml" icon="pi pi-plus" styleClass="ui-button-success" />
        </div>
    </h:form>

    <p:confirmDialog widgetVar="confirmacaoExclusao" header="Confirmação de Exclusão Lógica" 
                     message="Tem certeza que deseja desativar o usuário '#{usuarioBean.usuarioParaExcluir.nomeCompleto}'?" 
                     icon="pi pi-exclamation-triangle" appendTo="@(body)">
        <h:form id="formConfirmacao">
            <p:commandButton value="Sim, desativar" icon="pi pi-check" 
                             actionListener="#{usuarioBean.confirmarExclusao}"
                             oncomplete="PF('confirmacaoExclusao').hide()" 
                             update=":formUsuarios:tabelaUsuarios :formUsuarios:growl" 
                             styleClass="ui-button-danger"/>
            <p:commandButton value="Não" type="button" icon="pi pi-times" 
                             onclick="PF('confirmacaoExclusao').hide()" 
                             styleClass="ui-button-secondary"/>
        </h:form>
    </p:confirmDialog>
</h:body>
</html>