<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <style>
        .dashboard-container {
            padding: 20px;
        }
        .card-container {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 30px;
        }
        .dashboard-card {
            width: 280px;
            text-align: center;
        }
        .dashboard-card .card-icon {
            font-size: 48px;
            color: #007bff;
            margin-bottom: 15px;
        }
        .alert-estoque {
            border: 1px solid #FFCC80; 
            background-color: #FFF3E0; 
            color: #E65100;
            padding: 15px; 
            margin-bottom: 20px; 
            border-radius: 8px;
            display: flex; 
            justify-content: center;
            align-items: center; 
        }
        .alert-estoque .pi { 
	        font-size: 1.5em; 
	        margin-right: 15px; 
        }
        .piechart {
		    width: 100%;
		    max-width: 450px;
		    height: 450px;
		    margin: auto;
		}
		.container-graficos {
		    display: flex; 
		    flex-wrap: wrap;
		    gap: 20px;
		    margin-top: 40px;
		}
		.wrapper-linechart {
		    flex: 2;
		    min-width: 300px;
		}
		.wrapper-piechart{
		    flex: 1;
		    min-width: 300px;
		}
        
    </style>

    <h:form id="formDashboard">
        <div class="dashboard-container">
            
            <div style="text-align: center; margin-bottom: 40px;">
                <h2>Visão Geral do Sistema</h2>
                <p>Acompanhe os principais indicadores em tempo real.</p>
            </div>
            <h:panelGroup id="painelAlertaEstoque" styleClass="alert-estoque" 
              layout="block" rendered="#{dashboardBean.alertaEstoqueVisivel}">
                
                <div style="display: flex; align-items: center; flex-grow: 1;">
                    <i class="pi pi-exclamation-triangle"></i>
                    <h:outputText value="Atenção: #{dashboardBean.produtosComEstoqueBaixo.size()} produto(s) estão com o estoque abaixo do mínimo!" 
                                  style="font-weight: bold;"/>
                </div>
                
                <p:commandButton value="Ver Detalhes" icon="pi pi-search"
                                 type="button" 
                                 onclick="PF('dialogEstoqueBaixo').show()"
                                 styleClass="ui-button-warning" />
                                 
            </h:panelGroup>

            <div class="card-container">
                 <p:card styleClass="dashboard-card">
                    <f:facet name="title">Usuários Cadastrados</f:facet>
                    <f:facet name="subtitle">#{dashboardBean.totalUsuarios}</f:facet>
                    <i class="pi pi-users card-icon"></i>
                    <p>Total de usuários no sistema.</p>
                </p:card>
                <p:card styleClass="dashboard-card">
                    <f:facet name="title">Produtos Ativos</f:facet>
                    <f:facet name="subtitle">#{dashboardBean.totalProdutos}</f:facet>
                    <i class="pi pi-box card-icon"></i>
                    <p>Itens disponíveis no catálogo.</p>
                </p:card>
                <p:card styleClass="dashboard-card">
                    <f:facet name="title">Fornecedores</f:facet>
                    <f:facet name="subtitle">#{dashboardBean.totalFornecedores}</f:facet>
                    <i class="pi pi-truck card-icon"></i>
                    <p>Parceiros e fornecedores registrados.</p>
                </p:card>
            </div>

			<div class="container-graficos">

			    <div class="wrapper-linechart">
			        <p:panel header="Faturamento Mensal">
			            <p:lineChart model="#{dashboardBean.vendasPorMesModel}" 
			                         style="height:350px;" responsive="true"/>
			        </p:panel>
			    </div>
			
			    <div class="wrapper-piechart">
			        <p:panel header="Vendas por Forma de Pagamento">
			            <p:pieChart model="#{dashboardBean.vendasPorPagamentoModel}" 
			                        style="height:350px;" responsive="true"/>
			        </p:panel>
			    </div>

			</div>
        </div>
    </h:form>

    <p:dialog header="Produtos com Estoque Baixo" widgetVar="dialogEstoqueBaixo"
              modal="true" responsive="true" width="600"
              appendTo="@(body)">
              
        <p:dataTable var="item" value="#{dashboardBean.produtosComEstoqueBaixo}"
                     emptyMessage="Todos os produtos estão com o estoque em dia.">
            <p:column headerText="Produto">
                <h:outputText value="#{item.produto.nomeProduto}" />
            </p:column>
            <p:column headerText="Qtd. Atual" style="text-align: center;">
                <h:outputText value="#{item.quantidade}" style="font-weight: bold; color: red;" />
            </p:column>
            <p:column headerText="Qtd. Mínima" style="text-align: center;">
                <h:outputText value="#{item.quantidadeMinima}" />
            </p:column>
        </p:dataTable>
    </p:dialog>
</ui:composition>