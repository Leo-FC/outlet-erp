<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
<h:head>
    <title>Lista de Vendas</title>
    <h:outputStylesheet name="css/style.css" />
    <h:outputStylesheet name="css/panel.css" />
</h:head>
<h:body>
    <h:form id="formVendas">
        <p:growl id="growl" showDetail="true" />

        <p:panel>
            <f:facet name="header">
                <div class="module-header vendas">
                    <i class="pi pi-shopping-cart" style="font-size: 1.5rem;"></i>
                    <h:outputText value="Vendas Realizadas" style="font-size: 1.2rem;" />
                </div>
            </f:facet>
            <p:dataTable id="vendasTable" widgetVar="vendasTable"
                         var="venda" value="#{listarVendasBean.todasVendas}"
                         paginator="true" rows="10"
                         emptyMessage="Nenhuma venda encontrada.">

                <p:column headerText="ID" sortBy="#{venda.idVenda}" style="width: 80px;">
                    <h:outputText value="#{venda.idVenda}" />
                </p:column>
                
                <p:column headerText="Cliente" filterBy="#{venda.cliente.nomeCompleto}" filterMatchMode="contains">
                    <h:outputText value="#{venda.cliente != null ? venda.cliente.nomeCompleto : 'N/A'}" />
                </p:column>
                
                <p:column headerText="Vendedor" filterBy="#{venda.vendedor.nomeCompleto}" filterMatchMode="contains">
                    <h:outputText value="#{venda.vendedor != null ? venda.vendedor.nomeCompleto : 'N/A'}" />
                </p:column>
                
                <p:column headerText="Data" sortBy="#{venda.dataVendaDate}" style="width: 160px;">
                    <h:outputText value="#{venda.dataVendaDate}">
                        <f:convertDateTime pattern="dd/MM/yyyy HH:mm" timeZone="America/Sao_Paulo"/>
                    </h:outputText>
                </p:column>
                
                <p:column headerText="Valor Total" sortBy="#{venda.valorTotal}" style="width: 120px;">
                    <h:outputText value="#{venda.valorTotal}">
                        <f:convertNumber type="currency" currencySymbol="R$" locale="pt_BR" />
                    </h:outputText>
                </p:column>
                
                <p:column headerText="Forma de Pagamento" filterBy="#{venda.formaPagamento}" filterMatchMode="exact">
                    <f:facet name="filter">
                        <p:selectOneMenu onchange="PF('vendasTable').filter()" style="width:100%">
                            <f:selectItem itemLabel="Todos" itemValue="#{null}" noSelectionOption="true" />
                            <f:selectItems value="#{listarVendasBean.formasPagamento}" />
                        </p:selectOneMenu>
                    </f:facet>
                    <h:outputText value="#{venda.formaPagamento}" />
                </p:column>
                
                <p:column headerText="Ações" width="100" style="text-align: center;">
                    
                    
                    <p:commandButton icon="pi pi-times-circle" title="Cancelar Venda"
                                     actionListener="#{listarVendasBean.prepararCancelamento(venda)}"
                                     oncomplete="PF('confirmacaoCancelamento').show()"
                                     update=":formConfirmacao"
                                     styleClass="ui-button-danger ui-button-flat" />
                </p:column>
                
            </p:dataTable>
        </p:panel>
        
        <div style="padding: 15px; display: flex; justify-content: center; gap: 15px;">
            <p:button value="Voltar" outcome="/admin/painelAdmin.xhtml" icon="pi pi-arrow-left" styleClass="ui-button-secondary"/>
            <p:button value="Registrar Nova Venda" outcome="/admin/venda/venda.xhtml" icon="pi pi-plus" styleClass="ui-button-success"/>
        </div>
    </h:form>

    <p:confirmDialog widgetVar="confirmacaoCancelamento" header="Confirmação" 
                     message="Tem certeza que deseja cancelar a venda?" 
                     icon="pi pi-exclamation-triangle" appendTo="@(body)">
        <h:form id="formConfirmacao">
            <p:commandButton value="Sim, cancelar" icon="pi pi-check" 
                             actionListener="#{listarVendasBean.confirmarCancelamento}"
                             oncomplete="PF('confirmacaoCancelamento').hide()" 
                             update=":formVendas:vendasTable :formVendas:growl" 
                             styleClass="ui-button-danger"/>
            <p:commandButton value="Não" type="button" icon="pi pi-times" 
                             onclick="PF('confirmacaoCancelamento').hide()" 
                             styleClass="ui-button-secondary"/>
        </h:form>
    </p:confirmDialog>
</h:body>
</html>